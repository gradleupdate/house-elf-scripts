apply plugin: 'groovy'
apply plugin: 'idea'
apply plugin: 'maven'
apply plugin: 'java-library-distribution'
apply from: 'http://tellurianring.com/projects/gradle-plugins/gradle-release/apply.groovy'

group = 'org.yukung'

sourceCompatibility = 1.7

repositories {
    mavenCentral()
}

configurations {
    deployJars
}

dependencies {
    groovy 'org.codehaus.groovy:groovy-all:2.2.2'
    testCompile 'org.spockframework:spock-core:0.7-groovy-2.0'
    compile('org.apache.xmlrpc:xmlrpc-client:3.1.3') {
        exclude module: 'junit'
    }
    compile 'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
    deployJars 'org.apache.maven.wagon:wagon-webdav-jackrabbit:2.6'
}

import org.apache.tools.ant.filters.ReplaceTokens

processResources {
    ext {
        backlogPassword = project.hasProperty('backlogPassword') ? project.backlogPassword : ''
        clientId = project.hasProperty('clientId') ? project.clientId : ''
        clientSecret = project.hasProperty('clientSecret') ? project.clientSecret : ''
    }
    filter(ReplaceTokens, tokens: [password: backlogPassword, clientId: clientId, clientSecret: clientSecret])
}

uploadArchives {
    repositories {
        mavenDeployer {
            configureAuth = {
                authentication(userName: 'ikeda-yusuke', password: password)
            }
            configuration = configurations.deployJars
            // repository(url: "file:${System.getProperty('user.home')}/.m2/repository")
            snapshotRepository(url: 'dav:https://repository-yusukei.forge.cloudbees.com/snapshot/', configureAuth)
            repository(url: 'dav:https://repository-yusukei.forge.cloudbees.com/release/', configureAuth)
        }
    }
}

createReleaseTag.dependsOn uploadArchives

idea {
    module {
        downloadJavadoc = true
        downloadSources = true
    }
}
